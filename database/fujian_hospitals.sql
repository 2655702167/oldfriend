-- 福建地区医院测试数据
-- 用于解决真机测试时医院列表为空的问题
-- 真机测试位置: 纬度26.0513°N, 经度119.1920°E (福建省福州市)

USE elderly_assistant;


DELETE FROM HOSPITAL_INFO WHERE hospital_id IN ('H008', 'H009', 'H010', 'H011', 'H012');

-- 插入福建省福州市附近的医院数据
-- 距离真机测试位置(26.0513, 119.1920)约5-15公里范围内

INSERT INTO HOSPITAL_INFO (
    hospital_id,
    hospital_name,
    address,
    longitude,
    latitude,
    phone,
    hospital_level,
    departments,
    daily_quota,
    available_quota,
    opening_hours,
    status
) VALUES 
-- H008: 福州市第一医院 (距离测试点约12.5公里)
(
    'H008',
    '福州市第一医院',
    '福建省福州市台江区达道路190号',
    119.2920,
    26.0600,
    '0591-87678000',
    '三级甲等',
    '["内科","外科","儿科","妇产科","急诊科","骨科","神经科","心血管科"]',
    150,
    120,
    '24小时',
    'enabled'
),

-- H009: 福建省立医院 (距离测试点约15.3公里)
(
    'H009',
    '福建省立医院',
    '福建省福州市东街134号',
    119.3050,
    26.0850,
    '0591-87557768',
    '三级甲等',
    '["\u5185\u79d1","\u5916\u79d1","\u9aa8\u79d1","\u795e\u7ecf\u79d1","\u5fc3\u8840\u7ba1\u79d1","\u547c\u5438\u79d1","\u80bf\u7624\u79d1"]',
    200,
    180,
    '24\u5c0f\u65f6',
    'enabled'
),

-- H010: 福州市中医院 (距离测试点约16.1公里)
(
    'H010',
    '福州市中医院',
    '福建省福州市鼓楼区五一北路293号',
    119.3010,
    26.0930,
    '0591-83258421',
    '三级甲等',
    '["\u4e2d\u533b\u79d1","\u9488\u7078\u79d1","\u9aa8\u79d1","\u63a8\u62ff\u79d1","\u5185\u79d1","\u5987\u79d1"]',
    120,
    100,
    '周一至周六 8:00-17:00',
    'enabled'
),

-- H011: 福建医科大学附属第一医院 (距离测试点约10.8公里)
(
    'H011',
    '福建医科大学附属第一医院',
    '福建省福州市台江区茶园路20号',
    119.2750,
    26.0450,
    '0591-87981888',
    '三级甲等',
    '["\u5185\u79d1","\u5916\u79d1","\u6025\u8bca\u79d1","\u513f\u79d1","\u5987\u4ea7\u79d1","\u9aa8\u79d1","\u5fc3\u8840\u7ba1\u79d1"]',
    180,
    150,
    '24\u5c0f\u65f6',
    'enabled'
),

-- H012: 福州市第二医院 (距离测试点约8.5公里)
(
    'H012',
    '福州市第二医院',
    '福建省福州市仓山区上藤路47号',
    119.2650,
    26.0280,
    '0591-83292755',
    '三级',
    '["\u5185\u79d1","\u5916\u79d1","\u6025\u8bca\u79d1","\u513f\u79d1","\u5987\u4ea7\u79d1","\u9aa8\u79d1"]',
    100,
    85,
    '周一至周日 8:00-17:00',
    'enabled'
);

-- 验证插入结果
SELECT 
    hospital_id,
    hospital_name,
    address,
    longitude,
    latitude,
    hospital_level,
    phone
FROM HOSPITAL_INFO 
WHERE hospital_id IN ('H008', 'H009', 'H010', 'H011', 'H012')
ORDER BY hospital_id;

-- 计算距离测试点的距离（使用Haversine公式简化版）
-- 测试点: 26.0513°N, 119.1920°E
-- 距离公式: sqrt((lat2-lat1)^2 + (lon2-lon1)^2) * 111 (约等于公里数)
SELECT 
    hospital_id,
    name,
    ROUND(
        SQRT(
            POW((latitude - 26.0513), 2) + 
            POW((longitude - 119.1920), 2)
        ) * 111, 
        2
    ) AS distance_km
FROM HOSPITAL_INFO 
WHERE hospital_id IN ('H008', 'H009', 'H010', 'H011', 'H012')
ORDER BY distance_km;

-- 预期结果:
-- H012 福州市第二医院      ~8.5公里  (最近)
-- H011 福建医科大学附一院  ~10.8公里
-- H008 福州市第一医院      ~12.5公里 (应显示在top3中)
-- H009 福建省立医院        ~15.3公里
-- H010 福州市中医院        ~16.1公里

-- ================================
-- 使用说明
-- ================================
-- 1. 在MySQL中执行此SQL文件:
--    source /path/to/fujian_hospitals.sql;
--    或者在MySQL客户端中直接复制粘贴执行
--
-- 2. 重启Java后端服务
--    cd java-backend
--    mvn spring-boot:run
--
-- 3. 重新测试小程序挂号模块
--    - 打开挂号页面
--    - 点击"获取当前位置"
--    - 应显示3家最近的医院 (H012, H011, H008)
--
-- ================================
-- 注意事项
-- ================================
-- 1. 确保真机测试位置在福州市区附近 (26.0°N, 119.2°E 范围)
-- 2. 如果测试位置不在福州，需要修改医院经纬度或测试位置
-- 3. 医院数据中的电话和地址为示例数据，实际使用需要核实
-- 4. 保留北京地区医院数据 (H003-H007)，可用于多地测试

-- ================================
-- 后端代码提示
-- ================================
-- calculateNearbyHospitals() 函数的距离计算逻辑:
-- 1. 使用Haversine公式计算每家医院到当前位置的距离
-- 2. 按距离从近到远排序
-- 3. 取前3家医院显示
-- 
-- 如果仍然显示为空，检查:
-- - 后端是否正确读取了这些医院数据
-- - HospitalInfo实体类的@TableName是否为"hospital_info"
-- - MySQL数据库表名是否为小写 (hospital_info)

COMMIT;
