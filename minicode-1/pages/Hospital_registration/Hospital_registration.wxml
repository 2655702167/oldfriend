<!--pages/Hospital_registration/Hospital_registration.wxml-->
<view style="height:60rpx"></view>
<view class="nav-bar">
  <view style="width:20%;">
    <image style="width:80rpx;padding-left: 20rpx;" src="/images/Left_arrow_red.png" mode="widthFix" bind:tap="goToIndex"></image>
  </view>
  <view style="width: 80%;text-align:center;">
    <text style="font-size: {{fontSizes.title}};margin-right: 24%;color: white;">åŒ»é™¢æŒ‚å·</text>
  </view>
</view>
<scroll-view class="registration-scroll" scroll-y="true" enhanced="true" show-scrollbar="false">
<view class="search-bar">
  <input 
    class="search-input" 
    placeholder="è¯­éŸ³è¾“å…¥ç—‡çŠ¶æˆ–ç§‘å®¤..." 
    placeholder-style="color: #999;"
    style="font-size: {{fontSizes.content}};"
    value="{{searchText}}"
    bindinput="onSearchInput"
    bindconfirm="onSearchConfirm"
    confirm-type="search"
  />
    <image 
      style="width:70rpx;margin-left: 60rpx;" 
      src="/images/Microphone_red.png" 
      mode="widthFix"
      class="{{isRecording ? 'recording' : ''}}"
      bindtouchstart="onVoiceStart"
      bindtouchend="onVoiceEnd"
    />
</view>
<text style="font-size: {{fontSizes.content}};margin-top: 40rpx;margin-left: 30rpx;">é€‰æ‹©ç§‘å®¤</text>
<!-- è°ƒè¯•ä¿¡æ¯ -->
<view style="margin: 20rpx; padding: 10rpx; background: #f0f0f0; font-size: 24rpx; display: none;">
  <text>è°ƒè¯•: locationSuccess={{locationSuccess}}, åŒ»é™¢æ•°={{nearbyHospitals.length}}</text>
</view>
<view class="department-container">
    <view class="tag-list">
      <department-tag 
        name="å†…ç§‘" 
        isActive="{{activeTag === 'å†…ç§‘'}}"
        bind:tagtap="onTagChange"
      />
      <department-tag 
        name="å¤–ç§‘" 
        isActive="{{activeTag === 'å¤–ç§‘'}}"
        bind:tagtap="onTagChange"
      />
      <department-tag 
        name="çœ¼ç§‘" 
        isActive="{{activeTag === 'çœ¼ç§‘'}}"
        bind:tagtap="onTagChange"
      />
      <department-tag 
        name="ä¸­åŒ»ç§‘" 
        isActive="{{activeTag === 'ä¸­åŒ»ç§‘'}}"
        bind:tagtap="onTagChange"
      />
      <department-tag 
        name="ç‰™ç§‘" 
        isActive="{{activeTag === 'ç‰™ç§‘'}}"
        bind:tagtap="onTagChange"
      />
      <department-tag 
        name="çš®è‚¤ç§‘" 
        isActive="{{activeTag === 'çš®è‚¤ç§‘'}}"
        bind:tagtap="onTagChange"
      />
    </view>
</view>
<!-- å®šä½æˆåŠŸåæ‰æ˜¾ç¤ºé™„è¿‘åŒ»é™¢åŒºåŸŸ -->
<block wx:if="{{locationSuccess === true}}">
  <view style="display: flex; justify-content: space-between; align-items: center; margin-top: 40rpx; margin-left: 30rpx; margin-right: 30rpx;">
    <text style="font-size: {{fontSizes.content}};">é™„è¿‘åŒ»é™¢</text>
    <text style="font-size: {{fontSizes.time}}; color: #666;">{{locationText}}</text>
  </view>

  <!-- æœ‰åŒ»é™¢æ•°æ®æ—¶æ˜¾ç¤ºåˆ—è¡¨ -->
  <block wx:if="{{nearbyHospitals.length > 0}}">
    <view class="hospital-card" wx:for="{{nearbyHospitals}}" wx:key="hospitalId">
      <view style="display: flex;width: 100%;justify-content: space-between;align-items: center;">
        <view style="display: flex;align-items: center;">
          <image style="width: 50rpx;height: 50rpx;margin-right: 15rpx;" src="/images/Hospital.png" mode="aspectFit"></image>
          <text style="font-size: {{fontSizes.content}};font-weight: bold;">{{item.hospitalName}}</text>
        </view>
        <view style="padding: 8rpx 20rpx;background-color: {{item.available ? '#99DD9C' : '#CFCEE8'}};border-radius: 10rpx;font-size: {{fontSizes.time}};">
          {{item.available ? 'å¯é¢„çº¦' : 'å·²æ»¡'}}
        </view>
      </view>
      <view style="margin-top: 15rpx;margin-left: 65rpx;">
        <text style="font-size: {{fontSizes.time}}; color: #666;">ğŸ“ è·ç¦» {{item.distanceText}}</text>
      </view>
      <view 
        class="booking-btn {{item.isReserved ? 'booking-btn-reserved' : (item.available ? 'booking-btn-active' : 'booking-btn-disabled')}}"
        bindtap="{{item.isReserved ? '' : (item.available ? 'makeReservation' : '')}}"
        data-hospital-id="{{item.hospitalId}}"
        data-hospital-name="{{item.hospitalName}}">
        <text style="font-size: {{fontSizes.button}};color: {{item.isReserved ? '#52C41A' : (item.available ? '#FF6B6B' : '#999')}};">
          {{item.isReserved ? 'âœ“ å·²é¢„çº¦' : (item.available ? 'ç«‹å³é¢„çº¦' : 'æš‚ä¸å¯çº¦')}}
        </text>
      </view>
    </view>
  </block>

  <!-- å®šä½æˆåŠŸä½†æœç´¢ä¸­æˆ–æ— ç»“æœ -->
  <block wx:else>
    <view style="text-align: center; padding: 100rpx 30rpx; color: #999;">
      <text style="font-size: {{fontSizes.content}};">æ­£åœ¨æœç´¢é™„è¿‘åŒ»é™¢...</text>
    </view>
  </block>
</block>

<!-- å®šä½æœªæˆåŠŸæ—¶åªæ˜¾ç¤ºæç¤ºæ–‡å­— -->
<block wx:if="{{locationSuccess === false}}">
  <view style="text-align: center; padding: 100rpx 30rpx; color: #999;">
    <text style="font-size: {{fontSizes.content}};">{{locationText}}</text>
  </view>
</block>

<!-- åº•éƒ¨å ä½ -->
<view style="height: 100rpx;"></view>
</scroll-view>
