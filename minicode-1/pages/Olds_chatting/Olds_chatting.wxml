<view class="page-wrap">
<view style="height:60rpx"></view>
<view class="nav-bar">
  <view style="width:20%;">
    <image style="width:80rpx;padding-left: 20rpx;" src="/images/Left_arrow_yellow.png" mode="widthFix" bind:tap="goToIndex"></image>
  </view>
  <view style="width: 80%;text-align:center;">
    <text style="font-size: {{fontSizes.title}};margin-right: 24%;color: white;">è€å‹é™ªèŠ</text>
  </view>
</view>




<!-- å¯¹è¯åˆ—è¡¨åŒºåŸŸï¼ˆç›´æ¥åµŒå…¥ä½ çš„é¡µé¢ï¼‰ -->
<scroll-view class="chat-container" scroll-y="true" scroll-with-animation="true" scroll-into-view="{{scrollIntoView}}">
  <view class="chat-list">
    <block wx:for="{{chatList}}" wx:key="id">
      <!-- AIæ¶ˆæ¯ï¼ˆå·¦ä¾§å¤´åƒï¼‰ -->
      <view id="msg-{{item.id}}" class="chat-item ai-chat" wx:if="{{item.sender === 'ai'}}">
        <image class="avatar" src="/images/ai_avatar.png" mode="widthFix" />
        <view class="message-wrapper">
          <view class="message ai-message" style="font-size: {{fontSizes.content}};">
            <text>{{item.content}}</text>
            <view class="time" style="font-size: {{fontSizes.time}};">{{item.time}}</view>
          </view>
        </view>
      </view>
      
      <!-- è‡ªå·±æ¶ˆæ¯ï¼ˆå³ä¾§å¤´åƒï¼‰ -->
      <view id="msg-{{item.id}}" class="chat-item self-chat" wx:else>
        <view class="message-wrapper">
          <view class="message self-message" style="font-size: {{fontSizes.content}};">
            <text>{{item.content}}</text>
            <view class="time" style="font-size: {{fontSizes.time}};">{{item.time}}</view>
          </view>
        </view>
        <image class="avatar" src="/images/user_avatar.png" mode="widthFix" />
      </view>
    </block>
    <!-- å¢åŠ åº•éƒ¨å«ç‰‡é«˜åº¦ï¼Œé˜²æ­¢è¢«è¾“å…¥æ¡†é®æŒ¡ -->
    <view id="{{bottomId}}" style="height: 300rpx;"></view>
  </view>
</scroll-view>


<!-- è¾“å…¥åŒºåŸŸ -->
<view class="input-area">
  <!-- æ–‡æœ¬è¾“å…¥æ¡† -->
  <input 
    class="text-input" 
    placeholder="è¯·è¾“å…¥æ¶ˆæ¯..." 
    value="{{inputContent}}"
    bindinput="onInputChange"
    bindconfirm="sendMessage"
    style="font-size: {{fontSizes.content}};"
  />
  
  <!-- æŒ‰é’®è¡Œï¼ˆåŒè¡Œæ’åˆ—ï¼šæŒ‰ä½è¯´è¯+å‘é€ï¼‰ -->
  <view class="btn-row">
    <button class="voice-btn" style="font-size: {{fontSizes.button}};" bindlongpress="startRecord" bindtouchend="stopRecord">
      æŒ‰ä½è¯´è¯
    </button>
    <button class="send-btn" bindtap="sendMessage" style="font-size: {{fontSizes.button}};">å‘é€</button>
  </view>
  
  <!-- åŠŸèƒ½æŒ‰é’®åŒº -->
  <view class="func-btns">
    <button class="func-btn" bindtap="switchVoiceType" style="font-size: {{fontSizes.button}};">ä½¿ç”¨å­™å­éŸ³è‰²</button>
    <button class="func-btn" bindtap="enterFestivalMode" style="font-size: {{fontSizes.button}};">èŠ‚æ—¥ç¥ç¦æ¨¡å¼</button>
  </view>
</view>

<!-- å½•éŸ³ä¸­å¼¹çª— -->
<view class="record-modal" wx:if="{{isRecording}}">
  <view class="record-icon">ğŸ¤</view>
  <view class="record-text">å½•éŸ³ä¸­...</view>
</view>
</view>
